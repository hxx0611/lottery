<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Âú®Á∫øÊäΩÂ•ñÂô®</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
      background: radial-gradient(circle at top, #1a2a6c, #16213e, #0f3460);
      color: #fff;
      min-height: 100vh;
      padding: 12px;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 1000px;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 18px;
      padding: 16px;
      backdrop-filter: blur(12px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.4);
    }

    /* ÂèØÁºñËæëÊ†áÈ¢ò */
    .title-input {
      width: 100%;
      font-size: 26px;
      text-align: center;
      border: none;
      background: transparent;
      color: #fff;
      font-weight: bold;
      outline: none;
      margin-bottom: 10px;
      letter-spacing: 2px;
    }

    textarea {
      width: 100%;
      height: 110px;
      border-radius: 12px;
      border: none;
      padding: 12px;
      font-size: 14px;
      resize: vertical;
      outline: none;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
      justify-content: space-between;
      align-items: center;
    }

    .left-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    input[type="number"] {
      width: 80px;
      padding: 6px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }

    button {
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.15s;
      font-weight: bold;
    }

    button:active { transform: scale(0.92); }

    .primary { background: #ff4d4f; color: #fff; }
    .secondary { background: #1890ff; color: #fff; }
    .danger { background: #ff7875; color: #fff; }

    .machine {
      margin-top: 18px;
      background: radial-gradient(circle at center, rgba(255,255,255,0.08), rgba(0,0,0,0.4));
      border-radius: 24px;
      padding: 16px;
      border: 2px solid rgba(255,255,255,0.15);
      min-height: 260px;
      overflow: hidden;
      position: relative;
    }

    .machine-title {
      text-align: center;
      margin-bottom: 8px;
      font-size: 15px;
      opacity: 0.9;
    }

    .ball-pool {
      position: relative;
      width: 100%;
      height: 220px;
      border-radius: 18px;
      background: radial-gradient(circle at center, rgba(255,255,255,0.06), rgba(0,0,0,0.2));
      overflow: hidden;
    }

    .pool-ball {
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      box-shadow: inset -3px -3px 6px rgba(0,0,0,0.4),
                  inset 2px 2px 4px rgba(255,255,255,0.6),
                  0 2px 6px rgba(0,0,0,0.5);
      will-change: transform;
      transition: transform 0.4s ease-out;
    }

    .highlight {
      transform: scale(2.3) !important;
      filter: brightness(2);
      box-shadow: 0 0 12px #fff, 0 0 30px #ffd700;
      z-index: 10;
    }

    .result-area {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      min-height: 80px;
    }

    .winner-ball {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #ffd700);
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      text-align: center;
      padding: 10px;
      animation: pop 0.6s ease;
      word-break: break-word;
      box-shadow: 0 12px 25px rgba(0,0,0,0.45);
    }

    @keyframes pop {
      0% { transform: scale(0.2) rotate(0deg); opacity: 0; }
      60% { transform: scale(1.2) rotate(360deg); opacity: 1; }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="container">
    <input id="titleInput" class="title-input" value="üéâ ‰∏ÉÂ¶àÁæ§ÂÜÖÊôíÂçïÊäΩÂ•ñ" />

    <textarea id="nameInput" placeholder="Á≤òË¥¥ÂèÇ‰∏éÂêçÂçïÔºàÊØèË°å‰∏Ä‰∏™‰∫∫Ôºâ"></textarea>

    <div class="controls">
      <div class="left-controls">
        <label>ÊØèÊ¨°ÊäΩÔºö</label>
        <input type="number" id="drawCount" value="1" min="1" />
        <button class="primary" onclick="startDraw()">ÂºÄÂßãÊäΩÂ•ñ</button>
        <button class="secondary" onclick="resetPool()">ÂàùÂßãÂåñÊäΩÂ•ñÊ±†</button>
        <button class="danger" onclick="clearResult()">Ê∏ÖÁ©∫ÁªìÊûú</button>
      </div>
    </div>

    <div class="machine">
      <div class="machine-title">ÂèÇ‰∏é‰∫∫Êï∞</div>
      <div class="ball-pool" id="ballPool"></div>
    </div>

    <div class="result-area" id="result"></div>
  </div>

  <script>
    let pool = [];
    let ballsPhysics = [];
    let animationId = null;
    let isDrawing = false;
    let isSettling = false;

    const colors = ['#ff4d4f','#40a9ff','#73d13d','#ffd666','#9254de','#36cfc9','#ff7a45','#597ef7','#f759ab','#ffa940'];

    function parseNames() {
      const text = document.getElementById('nameInput').value.trim();
      if (!text) return [];
      return text.split('\n').map(n => n.trim()).filter(n => n);
    }

    // ÂàùÂßãÂåñÊó∂Â∞èÁêÉÂ†ÜÂè†Âú®Â∫ïÈÉ®
    function stackBallsBottom() {
      const poolDiv = document.getElementById('ballPool');
      const rect = poolDiv.getBoundingClientRect();
      const width = rect.width;
      const ballSize = 22;
      const gap = 2;
      const perRow = Math.floor(width / (ballSize + gap));

      ballsPhysics.forEach((ball, index) => {
        const row = Math.floor(index / perRow);
        const col = index % perRow;
        const x = col * (ballSize + gap);
        const y = rect.height - (row + 1) * (ballSize + gap);

        ball.vx = 0;
        ball.vy = 0;
        ball.x = x;
        ball.y = y;
        ball.el.style.transform = `translate(${x}px, ${y}px)`;
      });
    }

    function createBalls() {
      const poolDiv = document.getElementById('ballPool');
      poolDiv.innerHTML = '';
      ballsPhysics = [];

      const rect = poolDiv.getBoundingClientRect();

      for (let i = 0; i < pool.length; i++) {
        const el = document.createElement('div');
        el.className = 'pool-ball';
        el.style.background = colors[i % colors.length];
        poolDiv.appendChild(el);

        ballsPhysics.push({
          el,
          x: 0,
          y: 0,
          vx: 0,
          vy: 0,
          size: 22
        });
      }

      // ÂàùÂßãÂ†ÜÂè†Âú®Â∫ïÈÉ®
      stackBallsBottom();
    }

    function physicsStep() {
      if (isSettling) return;

      const poolDiv = document.getElementById('ballPool');
      const rect = poolDiv.getBoundingClientRect();
      const width = rect.width;
      const height = rect.height;

      ballsPhysics.forEach(ball => {
        ball.x += ball.vx;
        ball.y += ball.vy;

        if (ball.x <= 0 || ball.x + ball.size >= width) {
          ball.vx *= -1;
        }
        if (ball.y <= 0 || ball.y + ball.size >= height) {
          ball.vy *= -1;
        }

        ball.el.style.transform = `translate(${ball.x}px, ${ball.y}px)`;
      });

      animationId = requestAnimationFrame(physicsStep);
    }

    function startChaos() {
      ballsPhysics.forEach(ball => {
        ball.vx = (Math.random() - 0.5) * 8;
        ball.vy = (Math.random() - 0.5) * 8;
      });
      cancelAnimationFrame(animationId);
      physicsStep();
    }

    function stopAndStackSmooth() {
      isSettling = true;
      cancelAnimationFrame(animationId);

      // ÈÄêÊ∏êÂáèÈÄüÂä®Áîª
      let decay = 0;
      const slowDown = () => {
        decay += 0.05;
        ballsPhysics.forEach(ball => {
          ball.vx *= 0.85;
          ball.vy *= 0.85;
          ball.x += ball.vx;
          ball.y += ball.vy;
          ball.el.style.transform = `translate(${ball.x}px, ${ball.y}px)`;
        });

        if (decay < 1) {
          requestAnimationFrame(slowDown);
        } else {
          stackBallsBottom();
          isSettling = false;
        }
      };
      slowDown();
    }

    function resetPool() {
      const names = parseNames();
      if (names.length === 0) {
        alert('ËØ∑ÂÖàÁ≤òË¥¥‰∫∫ÂëòÂêçÂçï');
        return;
      }
      pool = [...names];
      document.getElementById('result').innerHTML = '';
      createBalls(); // Âè™Â†ÜÂè†Ôºå‰∏ç‰π±Êíû
    }

    function clearResult() {
      document.getElementById('result').innerHTML = '';
    }

    function sleep(ms) {
      return new Promise(r => setTimeout(r, ms));
    }

    async function startDraw() {
      if (isDrawing) return;

      if (pool.length === 0) {
        const names = parseNames();
        if (names.length === 0) {
          alert('ËØ∑ÂÖàËæìÂÖ•‰∫∫ÂëòÂêçÂçï');
          return;
        }
        pool = [...names];
        createBalls();
      }

      let count = parseInt(document.getElementById('drawCount').value) || 1;
      count = Math.min(count, pool.length);
      if (count <= 0) return;

      isDrawing = true;
      const resultDiv = document.getElementById('result');
      const winners = [];

      // ÂºÄÂßã‰π±Êíû5Áßí
      startChaos();
      await sleep(5000);

      for (let i = 0; i < count; i++) {
        if (pool.length === 0) break;
        const winIndex = Math.floor(Math.random() * pool.length);
        winners.push(pool[winIndex]);
        pool.splice(winIndex, 1);
      }

      stopAndStackSmooth();

      resultDiv.innerHTML = '';
      winners.forEach(name => {
        const ball = document.createElement('div');
        ball.className = 'winner-ball';
        ball.innerText = name;
        resultDiv.appendChild(ball);
      });

      // ÈáçÊñ∞ÁîüÊàêÂâ©‰ΩôÁêÉÂπ∂Â†ÜÂè†
      await sleep(800);
      createBalls();
      isDrawing = false;
    }
  </script>
</body>
</html>
